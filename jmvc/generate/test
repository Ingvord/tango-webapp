if(arguments.length < 2){
	print("USAGE: js jmvc/generate/test type test_name app_name[optional]")
	print("type := unit | functional")
	print("app_name := under_scoped_name. If present newly created test will be added to the application\n");
	exit(127);
}
load('jmvc/generate/loader.js');

var app;
var app_path = '';
if(arguments[2]){
	app = load_app(arguments[2]);
	app_path += app.name + '/';
} else {
	app = {tests:{unit:[],functional:[]}}
}

var data = {
	name      : arguments[1],
	class_name: MVC.String.classize(arguments[1]) + 'Test'
}

ttype = arguments[0].toLowerCase();

if(ttype != 'unit' && ttype != 'functional') throw "IllegalArgument: unknown test type["+ttype+"]. Must be one of [unit,test]";

render_to(	"test/"+ttype+"/"+app_path+data.name+"_test.js",
			"jmvc/rhino/command/templates/"+ttype+"_test.ejs", data);

app.tests[ttype].push(app_path+data.name);

print("Generating ... test/"+ttype+"/"+app_path+data.name+"_test.js");

if(arguments[2]){
	save_app(app);
}

print("\n               Done!\n");
if(!arguments[2]){
print("\n               Make sure to add to your application files!\n");
}